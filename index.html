<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Industrial Timer Control</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        :root {
            --bg-body: #1e1e24;
            --bg-card: #2c2c34;
            --accent-orange: #f39c12;
            --accent-blue: #6d83f2;
            --text-gray: #8e8e93;
            --header-green: #14a071;
            --tab-green: #1b5e44;
        }

        body {
            background-color: var(--bg-body);
            color: white;
            font-family: 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            user-select: none;
        }

        /* Top Navigation Bar */
        .top-nav {
            background-color: var(--header-green);
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .tabs {
            display: flex;
            background-color: var(--tab-green);
            padding: 10px 0;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px 0;
            font-weight: bold;
            color: #bdc3c7;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            color: white;
            border-bottom: 3px solid white;
        }

        /* Container & Layout */
        .content { padding: 20px; }

        .device-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }

        .label-box {
            padding: 10px 25px;
            font-size: 32px;
            font-weight: bold;
            border-radius: 4px;
            color: #1a1a1a;
        }

        .orange-label { background-color: var(--accent-orange); }
        .blue-label { background-color: var(--accent-blue); }

        .main-value { font-size: 48px; font-weight: 300; }
        .orange-text { color: var(--accent-orange); }
        .blue-text { color: var(--accent-blue); }

        /* Timer Adjusters */
        .timer-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .adjust-card {
            background-color: var(--bg-card);
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            position: relative;
        }

        .card-label {
            color: var(--text-gray);
            font-size: 11px;
            text-align: left;
            text-transform: uppercase;
        }

        .counter-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
        }

        .btn-math {
            background: none;
            border: none;
            color: #555;
            font-size: 24px;
            cursor: pointer;
            padding: 0 10px;
        }

        .orange-btn { color: var(--accent-orange) !important; }
        .blue-btn { color: var(--accent-blue) !important; }

        .number-display { font-size: 36px; position: relative; }
        .unit { font-size: 14px; vertical-align: middle; }

        /* Pause Circles */
        .pause-container {
            display: flex;
            justify-content: space-between;
            margin: 25px 0;
        }

        .pause-item { text-align: center; }
        .pause-label { color: var(--text-gray); font-size: 10px; margin-bottom: 8px; }

        .circle {
            width: 75px;
            height: 75px;
            border: 2px solid var(--accent-orange);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: var(--accent-orange);
            cursor: pointer;
            transition: 0.2s;
        }

        .circle:active { background: rgba(243, 156, 18, 0.2); }

    </style>
</head>
<body>

    <div class="top-nav">
        <span>M√°y</span>
        <div style="display:flex; gap:15px">üîã üåê</div>
    </div>

    <div class="tabs">
        <div class="tab active">G GT 2</div>
        <div class="tab">PZEEM</div>
        <div class="tab">BB</div>
        <div class="tab">TK9..</div>
    </div>

    <div class="content">
        <div class="device-header">
            <div class="label-box orange-label">ao3</div>
            <div class="main-value orange-text" id="ao3-realtime">11</div>
        </div>

        <div class="timer-grid">
            <div class="adjust-card">
                <div class="card-label">Minute</div>
                <div class="counter-row">
                    <button class="btn-math" onclick="sendCmd('ao3/min', -1)">‚àí</button>
                    <div class="number-display">8<span class="unit">Min</span></div>
                    <button class="btn-math orange-btn" onclick="sendCmd('ao3/min', 1)">+</button>
                </div>
            </div>
            <div class="adjust-card">
                <div class="card-label">Second</div>
                <div class="counter-row">
                    <button class="btn-math" onclick="sendCmd('ao3/sec', -1)">‚àí</button>
                    <div class="number-display">12<span class="unit">Sec</span></div>
                    <button class="btn-math orange-btn" onclick="sendCmd('ao3/sec', 1)">+</button>
                </div>
            </div>
        </div>

        <div class="pause-container">
            <div class="pause-item">
                <div class="pause-label">PAUSE 1M</div>
                <div class="circle" onclick="sendCmd('pause', 1)">1</div>
            </div>
            <div class="pause-item">
                <div class="pause-label">PAUSE 15M</div>
                <div class="circle" onclick="sendCmd('pause', 15)">15</div>
            </div>
            <div class="pause-item">
                <div class="pause-label">PAUSE 30M</div>
                <div class="circle" onclick="sendCmd('pause', 30)">30</div>
            </div>
            <div class="pause-item">
                <div class="pause-label">PAUSE 60M</div>
                <div class="circle" onclick="sendCmd('pause', 60)">60</div>
            </div>
        </div>

        <div class="device-header" style="justify-content: flex-end;">
            <div class="main-value blue-text" style="margin-right: 15px;">237</div>
            <div class="label-box blue-label">ao4</div>
        </div>

        <div class="timer-grid">
            <div class="adjust-card">
                <div class="card-label">Minute</div>
                <div class="counter-row">
                    <button class="btn-math" onclick="sendCmd('ao4/min', -1)">‚àí</button>
                    <div class="number-display">7<span class="unit">Min</span></div>
                    <button class="btn-math blue-btn" onclick="sendCmd('ao4/min', 1)">+</button>
                </div>
            </div>
            <div class="adjust-card">
                <div class="card-label">Second</div>
                <div class="counter-row">
                    <button class="btn-math" onclick="sendCmd('ao4/sec', -1)">‚àí</button>
                    <div class="number-display">5<span class="unit">Sec</span></div>
                    <button class="btn-math blue-btn" onclick="sendCmd('ao4/sec', 1)">+</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh k·∫øt n·ªëi MQTT
        const broker = 'wss://n21f2dda.ala.dedicated.aws.emqxcloud.com:8084/mqtt';
        const options = {
            username: 'anhtrung1',
            password: 'anhtrung1',
            clientId: 'mobile_ui_' + Math.random().toString(16).substr(2, 4)
        };

        const client = mqtt.connect(broker, options);

        client.on('connect', () => {
            console.log("Connected to EMQX Cloud");
            // ƒêƒÉng k√Ω nh·∫≠n d·ªØ li·ªáu ph·∫£n h·ªìi t·ª´ m√°y
            client.subscribe('device/status/#');
        });

        // H√†m g·ª≠i l·ªánh khi b·∫•m n√∫t
        function sendCmd(path, value) {
            const topic = `timer/set/${path}`;
            client.publish(topic, value.toString());
            console.log(`Published: ${value} to ${topic}`);
        }

        // C·∫≠p nh·∫≠t gi√° tr·ªã hi·ªÉn th·ªã khi nh·∫≠n ƒë∆∞·ª£c tin nh·∫Øn t·ª´ MQTT
        client.on('message', (topic, payload) => {
            if (topic === 'device/status/ao3') {
                document.getElementById('ao3-realtime').innerText = payload.toString();
            }
        });
    </script>
</body>
</html>
